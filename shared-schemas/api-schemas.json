{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CogniSync API Schemas",
  "description": "JSON Schema definitions for standardized REST API communication",
  "definitions": {
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
    },
    "iso8601": {
      "type": "string",
      "format": "date-time"
    },
    "errorCode": {
      "type": "string",
      "enum": [
        "VALIDATION_ERROR", "NOT_FOUND", "UNAUTHORIZED", "FORBIDDEN",
        "TENANT_ISOLATION_ERROR", "RATE_LIMIT_EXCEEDED", "INTERNAL_ERROR",
        "SERVICE_UNAVAILABLE", "TIMEOUT", "CONFLICT", "UNPROCESSABLE_ENTITY"
      ]
    },
    "apiError": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": { "$ref": "#/definitions/errorCode" },
        "message": { "type": "string", "minLength": 1 },
        "details": { "type": "object" }
      },
      "additionalProperties": false
    },
    "responseMetadata": {
      "type": "object",
      "required": ["timestamp", "version", "requestId", "processingTime"],
      "properties": {
        "timestamp": { "$ref": "#/definitions/iso8601" },
        "version": { "type": "string", "minLength": 1 },
        "requestId": { "$ref": "#/definitions/uuid" },
        "processingTime": { "type": "number", "minimum": 0 }
      },
      "additionalProperties": false
    },
    "paginationInfo": {
      "type": "object",
      "required": ["page", "limit", "total", "totalPages"],
      "properties": {
        "page": { "type": "number", "minimum": 1 },
        "limit": { "type": "number", "minimum": 1, "maximum": 1000 },
        "total": { "type": "number", "minimum": 0 },
        "totalPages": { "type": "number", "minimum": 0 }
      },
      "additionalProperties": false
    },
    "searchFilters": {
      "type": "object",
      "properties": {
        "documentTypes": {
          "type": "array",
          "items": { "type": "string" },
          "uniqueItems": true
        },
        "sources": {
          "type": "array",
          "items": { "type": "string" },
          "uniqueItems": true
        },
        "dateRange": {
          "type": "object",
          "properties": {
            "start": { "$ref": "#/definitions/iso8601" },
            "end": { "$ref": "#/definitions/iso8601" }
          },
          "additionalProperties": false
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "uniqueItems": true
        }
      },
      "additionalProperties": false
    }
  },
  "schemas": {
    "apiResponse": {
      "type": "object",
      "required": ["success", "metadata"],
      "properties": {
        "success": { "type": "boolean" },
        "data": {},
        "error": { "$ref": "#/definitions/apiError" },
        "metadata": { "$ref": "#/definitions/responseMetadata" },
        "pagination": { "$ref": "#/definitions/paginationInfo" }
      },
      "additionalProperties": false,
      "if": {
        "properties": { "success": { "const": true } }
      },
      "then": {
        "required": ["success", "data", "metadata"],
        "not": { "required": ["error"] }
      },
      "else": {
        "required": ["success", "error", "metadata"],
        "not": { "required": ["data"] }
      }
    },
    "healthCheckResponse": {
      "type": "object",
      "required": ["status", "message", "timestamp"],
      "properties": {
        "status": {
          "type": "string",
          "enum": ["healthy", "degraded", "unhealthy"]
        },
        "message": { "type": "string", "minLength": 1 },
        "timestamp": { "$ref": "#/definitions/iso8601" },
        "version": { "type": "string" },
        "uptime": { "type": "number", "minimum": 0 },
        "services": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_-]+$": {
              "type": "string",
              "enum": ["up", "down"]
            }
          },
          "additionalProperties": false
        },
        "metrics": {
          "type": "object",
          "properties": {
            "uptime": { "type": "number", "minimum": 0 },
            "memoryUsage": { "type": "number", "minimum": 0, "maximum": 100 },
            "cpuUsage": { "type": "number", "minimum": 0, "maximum": 100 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "atlassianSyncEvent": {
      "type": "object",
      "required": ["id", "type", "source", "timestamp", "changes", "processingStatus", "retryCount", "tenantId"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "type": { "type": "string", "minLength": 1 },
        "source": {
          "type": "string",
          "enum": ["jira", "confluence"]
        },
        "timestamp": { "$ref": "#/definitions/iso8601" },
        "actorId": { "type": "string" },
        "entityId": { "type": "string" },
        "externalId": { "type": "string" },
        "changes": { "type": "object" },
        "processingStatus": {
          "type": "string",
          "enum": ["PENDING", "PROCESSING", "COMPLETED", "FAILED", "RETRYING", "DEAD_LETTER"]
        },
        "errorMessage": { "type": "string" },
        "retryCount": { "type": "number", "minimum": 0 },
        "tenantId": { "type": "string", "minLength": 1 },
        "configId": { "type": "string" }
      },
      "additionalProperties": false
    },
    "atlassianSyncConfiguration": {
      "type": "object",
      "required": ["id", "name", "tenantId", "source", "enabled", "webhookSecret", "kgServiceUrl", "kgApiKey", "mappingRules", "batchSize", "retryLimit", "retryDelay", "createdAt", "updatedAt"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "name": { "type": "string", "minLength": 1 },
        "tenantId": { "type": "string", "minLength": 1 },
        "source": { "type": "string", "minLength": 1 },
        "enabled": { "type": "boolean" },
        "webhookSecret": { "type": "string", "minLength": 1 },
        "webhookUrl": { "type": "string", "format": "uri" },
        "kgServiceUrl": { "type": "string", "format": "uri" },
        "kgApiKey": { "type": "string", "minLength": 1 },
        "mappingRules": { "type": "object" },
        "filters": { "type": "object" },
        "batchSize": { "type": "number", "minimum": 1, "maximum": 1000 },
        "retryLimit": { "type": "number", "minimum": 0, "maximum": 10 },
        "retryDelay": { "type": "number", "minimum": 1000 },
        "createdAt": { "$ref": "#/definitions/iso8601" },
        "updatedAt": { "$ref": "#/definitions/iso8601" }
      },
      "additionalProperties": false
    },
    "knowledgeGraphEntity": {
      "type": "object",
      "required": ["id", "type", "name", "properties", "metadata", "createdAt", "updatedAt"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "type": { "type": "string", "minLength": 1 },
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "properties": { "type": "object" },
        "metadata": {
          "type": "object",
          "required": ["confidence", "importance", "source", "extractionMethod", "tags", "aliases"],
          "properties": {
            "confidence": {
              "type": "string",
              "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
            },
            "importance": {
              "type": "string",
              "enum": ["MINOR", "MODERATE", "SIGNIFICANT", "CRITICAL"]
            },
            "source": { "type": "string", "minLength": 1 },
            "extractionMethod": {
              "type": "string",
              "enum": ["MANUAL", "NLP", "LLM", "PATTERN_MATCHING", "API_INTEGRATION", "INFERENCE"]
            },
            "tags": {
              "type": "array",
              "items": { "type": "string" },
              "uniqueItems": true
            },
            "aliases": {
              "type": "array",
              "items": { "type": "string" },
              "uniqueItems": true
            }
          },
          "additionalProperties": false
        },
        "tenantId": { "type": "string" },
        "createdAt": { "$ref": "#/definitions/iso8601" },
        "updatedAt": { "$ref": "#/definitions/iso8601" }
      },
      "additionalProperties": false
    },
    "knowledgeGraphRelationship": {
      "type": "object",
      "required": ["id", "sourceEntityId", "targetEntityId", "type", "weight", "confidence", "metadata", "createdAt", "updatedAt"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "sourceEntityId": { "type": "string", "minLength": 1 },
        "targetEntityId": { "type": "string", "minLength": 1 },
        "type": { "type": "string", "minLength": 1 },
        "weight": { "type": "number", "minimum": 0 },
        "confidence": {
          "type": "string",
          "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
        },
        "properties": { "type": "object" },
        "metadata": {
          "type": "object",
          "required": ["source", "extractionMethod", "evidenceCount", "isInferred"],
          "properties": {
            "source": { "type": "string", "minLength": 1 },
            "extractionMethod": {
              "type": "string",
              "enum": ["MANUAL", "NLP", "LLM", "PATTERN_MATCHING", "API_INTEGRATION", "INFERENCE"]
            },
            "evidenceCount": { "type": "number", "minimum": 0 },
            "isInferred": { "type": "boolean" },
            "context": { "type": "string" }
          },
          "additionalProperties": false
        },
        "tenantId": { "type": "string" },
        "createdAt": { "$ref": "#/definitions/iso8601" },
        "updatedAt": { "$ref": "#/definitions/iso8601" }
      },
      "additionalProperties": false
    },
    "llmRagQueryRequest": {
      "type": "object",
      "required": ["query", "tenantId"],
      "properties": {
        "query": { "type": "string", "minLength": 1 },
        "tenantId": { "type": "string", "minLength": 1 },
        "sessionId": { "type": "string" },
        "userId": { "type": "string" },
        "context": { "type": "object" },
        "maxResults": { "type": "number", "minimum": 1, "maximum": 100 },
        "filters": { "$ref": "#/definitions/searchFilters" },
        "options": {
          "type": "object",
          "properties": {
            "includeAnalysis": { "type": "boolean" },
            "includeSuggestions": { "type": "boolean" },
            "sources": {
              "type": "array",
              "items": { "type": "string" },
              "uniqueItems": true
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "llmRagQueryResponse": {
      "type": "object",
      "required": ["sessionId", "response", "context", "sources", "processingTime", "metadata"],
      "properties": {
        "sessionId": { "type": "string", "minLength": 1 },
        "response": { "type": "string", "minLength": 1 },
        "context": {
          "type": "object",
          "required": ["intent", "entities", "keywords", "urgency", "complexity"],
          "properties": {
            "intent": {
              "type": "string",
              "enum": ["business", "technical", "project", "requirements", "status"]
            },
            "entities": {
              "type": "array",
              "items": { "type": "string" }
            },
            "keywords": {
              "type": "array",
              "items": { "type": "string" }
            },
            "urgency": {
              "type": "string",
              "enum": ["low", "medium", "high"]
            },
            "complexity": {
              "type": "string",
              "enum": ["simple", "moderate", "complex"]
            }
          },
          "additionalProperties": false
        },
        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["documentId", "title", "relevanceScore", "excerpt"],
            "properties": {
              "documentId": { "type": "string", "minLength": 1 },
              "title": { "type": "string", "minLength": 1 },
              "relevanceScore": { "type": "number", "minimum": 0, "maximum": 1 },
              "excerpt": { "type": "string", "minLength": 1 }
            },
            "additionalProperties": false
          }
        },
        "processingTime": { "type": "number", "minimum": 0 },
        "metadata": {
          "type": "object",
          "properties": {
            "totalDocuments": { "type": "number", "minimum": 0 },
            "searchTime": { "type": "number", "minimum": 0 },
            "llmTokens": { "type": "number", "minimum": 0 },
            "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    }
  }
}